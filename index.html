<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Earn | Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .hidden-sec { display: none !important; }
        #sidebar { transition: transform 0.3s ease-in-out; transform: translateX(-100%); }
        #sidebar.open { transform: translateX(0); }
        /* Progress Circle Styles */
        .progress-ring__circle { transition: stroke-dashoffset 0.35s; transform: rotate(-90deg); transform-origin: 50% 50%; }
    </style>
</head>
<body class="bg-slate-100 font-sans text-slate-800 h-screen overflow-hidden relative">

    <div id="sidebar" class="fixed inset-y-0 left-0 w-72 bg-slate-900 text-white z-[6000] shadow-2xl flex flex-col">
        <div class="p-6 border-b border-slate-700 bg-slate-800 flex justify-between items-center">
            <h2 class="text-xl font-black italic">DIGITAL EARN</h2>
            <button onclick="toggleSidebar()"><i class="fas fa-times"></i></button>
        </div>
        <nav class="flex-1 overflow-y-auto py-4">
            <a onclick="navigate('home')" class="px-6 py-4 hover:bg-slate-800 flex items-center gap-4 cursor-pointer"><i class="fas fa-home text-blue-400"></i> Home</a>
            <a onclick="navigate('profile')" class="px-6 py-4 hover:bg-slate-800 flex items-center gap-4 cursor-pointer"><i class="fas fa-user text-purple-400"></i> Profile</a>
            <a onclick="navigate('history')" class="px-6 py-4 hover:bg-slate-800 flex items-center gap-4 cursor-pointer"><i class="fas fa-history text-green-400"></i> Live History</a>
            <a onclick="navigate('plans')" class="px-6 py-4 hover:bg-slate-800 flex items-center gap-4 cursor-pointer"><i class="fas fa-crown text-yellow-400"></i> Plans</a>
            <a onclick="logout()" class="px-6 py-4 text-red-400 flex items-center gap-4 cursor-pointer"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </nav>
    </div>
    <div id="sidebar-overlay" onclick="toggleSidebar()" class="hidden-sec fixed inset-0 bg-black/60 z-[5999]"></div>

    <div id="auth-page" class="min-h-screen flex items-center justify-center p-6 bg-white absolute inset-0 z-[5000]">
        <div class="w-full max-w-md">
            <h1 class="text-4xl font-black text-blue-900 mb-2">Digital Earn</h1>
            <p id="auth-sub" class="text-slate-400 mb-8">Please login to access your dashboard</p>
            <div class="space-y-4">
                <input id="auth-email" type="email" placeholder="Email" class="w-full p-4 bg-slate-50 rounded-2xl border outline-none focus:border-blue-500">
                <input id="auth-pass" type="password" placeholder="Password" class="w-full p-4 bg-slate-50 rounded-2xl border outline-none focus:border-blue-500">
                <button onclick="handleAuth()" id="auth-btn" class="w-full bg-blue-900 text-white font-bold py-4 rounded-2xl">LOGIN</button>
            </div>
            <p class="text-center mt-6 text-sm">New here? <button onclick="toggleAuth()" class="text-blue-600 font-bold">Register Now</button></p>
        </div>
    </div>

    <div id="app-area" class="hidden-sec h-full flex flex-col">
        <header class="bg-white p-4 flex justify-between items-center shadow-sm">
            <button onclick="toggleSidebar()" class="text-xl p-2"><i class="fas fa-bars"></i></button>
            <span class="font-bold text-blue-900 italic">DASHBOARD</span>
            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center"><i class="fas fa-user text-blue-500"></i></div>
        </header>

        <main class="flex-1 overflow-y-auto pb-24 p-6 bg-slate-50 space-y-6">
            
            <div id="tab-home" class="space-y-6">
                <div class="bg-white p-6 rounded-[35px] shadow-sm flex items-center justify-around border">
                    <div class="relative flex items-center justify-center">
                        <svg class="w-24 h-24">
                            <circle class="text-slate-100" stroke-width="8" stroke="currentColor" fill="transparent" r="40" cx="48" cy="48"/>
                            <circle id="progress-circle" class="text-blue-600 progress-ring__circle" stroke-width="8" stroke-dasharray="251.2" stroke-dashoffset="251.2" stroke-linecap="round" stroke="currentColor" fill="transparent" r="40" cx="48" cy="48"/>
                        </svg>
                        <span id="progress-text" class="absolute font-black text-lg">0%</span>
                    </div>
                    <div>
                        <h3 class="font-bold text-slate-700">Daily Goal</h3>
                        <p class="text-xs text-slate-400">Complete tasks to fill circle</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 gap-4">
                    <div class="bg-blue-900 p-6 rounded-[30px] text-white">
                        <p class="text-[10px] uppercase font-bold opacity-70">Total Balance</p>
                        <h1 class="text-3xl font-black">Rs. <span id="disp-balance">0.00</span></h1>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <button onclick="window.open('https://wa.me/923707340477')" class="bg-white p-4 rounded-2xl border flex flex-col items-center gap-2">
                        <i class="fab fa-whatsapp text-2xl text-green-500"></i>
                        <span class="text-[10px] font-bold">WhatsApp Help</span>
                    </button>
                    <button class="bg-white p-4 rounded-2xl border flex flex-col items-center gap-2">
                        <i class="fas fa-headset text-2xl text-blue-500"></i>
                        <span class="text-[10px] font-bold">Support Center</span>
                    </button>
                </div>

                <div class="bg-white p-6 rounded-3xl border">
                    <h4 class="font-bold mb-3 text-sm italic">Platform Reviews</h4>
                    <div class="flex items-center gap-2 mb-4">
                        <i class="fas fa-star text-yellow-400"></i>
                        <span class="font-bold">4.9/5.0</span>
                        <span class="text-[10px] text-slate-400">(1,240 Reviews)</span>
                    </div>
                    <div class="space-y-3">
                        <div class="text-[10px] border-l-2 border-blue-500 pl-3">
                            <p class="font-bold italic">"Best earning app in Pakistan. Fast withdrawals!"</p>
                            <p class="text-slate-400">- Ahmed Khan</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-tasks" class="hidden-sec space-y-6">
                <div class="bg-white p-8 rounded-[40px] text-center border-2 border-dashed">
                    <i class="fas fa-play-circle text-6xl text-blue-600 mb-4"></i>
                    <h2 class="text-xl font-bold">Watch & Earn</h2>
                    <p id="task-rem" class="text-sm text-slate-400 mb-6">0 Tasks remaining</p>
                    <button onclick="doTask()" class="w-full bg-blue-600 text-white font-bold py-4 rounded-2xl shadow-lg">WATCH AD</button>
                </div>
            </div>

            <div id="tab-profile" class="hidden-sec space-y-6">
                <div class="bg-white p-6 rounded-3xl border text-center">
                    <div class="w-20 h-20 bg-slate-100 rounded-full mx-auto mb-4 flex items-center justify-center text-2xl text-slate-400"><i class="fas fa-user"></i></div>
                    <h2 id="prof-email" class="font-bold">User</h2>
                    <p class="text-xs text-blue-600 font-bold uppercase" id="prof-plan">Basic Plan</p>
                </div>
                <div class="bg-white p-6 rounded-3xl border">
                    <h4 class="font-bold text-sm mb-2">My Referrals</h4>
                    <p class="text-xs text-slate-400">Invite friends and get 15% commission.</p>
                </div>
            </div>

            <div id="tab-history" class="hidden-sec space-y-4">
                <h2 class="font-bold italic">Recent Activity</h2>
                <div id="history-container" class="space-y-3 text-[10px]">
                    </div>
            </div>

        </main>

        <nav class="bg-white border-t p-3 flex justify-around fixed bottom-0 w-full z-50">
            <button onclick="navigate('home')" id="btn-home" class="flex flex-col items-center gap-1 text-blue-600">
                <i class="fas fa-home text-lg"></i><span class="text-[9px] font-bold">Home</span>
            </button>
            <button onclick="navigate('tasks')" id="btn-tasks" class="flex flex-col items-center gap-1 text-slate-400">
                <i class="fas fa-tasks text-lg"></i><span class="text-[9px] font-bold">Task</span>
            </button>
            <button onclick="navigate('profile')" id="btn-profile" class="flex flex-col items-center gap-1 text-slate-400">
                <i class="fas fa-user text-lg"></i><span class="text-[9px] font-bold">Profile</span>
            </button>
        </nav>
    </div>

    <script>
        let user = JSON.parse(localStorage.getItem('user')) || null;
        let isLogin = true;

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('sidebar-overlay').classList.toggle('hidden-sec');
        }

        function navigate(tab) {
            document.querySelectorAll('[id^="tab-"]').forEach(t => t.classList.add('hidden-sec'));
            const target = tab === 'tasks' ? 'tab-tasks' : 'tab-' + tab;
            document.getElementById(target).classList.remove('hidden-sec');
            
            // Bottom Nav Colors
            ['home', 'tasks', 'profile'].forEach(btn => {
                const el = document.getElementById('btn-' + btn);
                if(el) el.className = (btn === tab) ? "flex flex-col items-center gap-1 text-blue-600" : "flex flex-col items-center gap-1 text-slate-400";
            });
            toggleSidebar();
        }

        function updateProgress(done, total) {
            const circle = document.getElementById('progress-circle');
            const text = document.getElementById('progress-text');
            const percent = (done / total) * 100;
            const offset = 251.2 - (percent / 100 * 251.2);
            circle.style.strokeDashoffset = offset;
            text.innerText = Math.round(percent) + "%";
        }

        async function handleAuth() {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-pass').value;
            const res = await fetch(isLogin ? '/api/login' : '/api/register', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ email, password, level: 1 })
            });
            const data = await res.json();
            if(data.success) {
                localStorage.setItem('user', JSON.stringify(data.user));
                location.reload();
            } else alert(data.error);
        }

        function toggleAuth() {
            isLogin = !isLogin;
            document.getElementById('auth-btn').innerText = isLogin ? "LOGIN" : "REGISTER";
        }

        async function doTask() {
            const res = await fetch('/api/task', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ email: user.email })
            });
            const data = await res.json();
            if(data.success) {
                user.balance = data.new_balance;
                user.daily_count = (user.daily_count || 0) + 1;
                localStorage.setItem('user', JSON.stringify(user));
                location.reload();
            } else alert(data.error);
        }

        function logout() { localStorage.clear(); location.reload(); }

        window.onload = () => {
            if(user) {
                document.getElementById('auth-page').classList.add('hidden-sec');
                document.getElementById('app-area').classList.remove('hidden-sec');
                
                document.getElementById('disp-balance').innerText = user.balance.toFixed(2);
                document.getElementById('prof-email').innerText = user.email;
                
                const limits = {1:10, 2:20, 3:30};
                const max = limits[user.level || 1];
                document.getElementById('task-rem').innerText = (max - (user.daily_count || 0)) + " Tasks remaining";
                updateProgress(user.daily_count || 0, max);
            } else {
                document.getElementById('auth-page').classList.remove('hidden-sec');
                document.getElementById('app-area').classList.add('hidden-sec');
            }
        };
    </script>
</body>
</html>
