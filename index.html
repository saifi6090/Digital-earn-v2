<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Earn | Professional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .animate-marquee { display: inline-block; animation: marquee 15s linear infinite; }
        .hidden-sec { display: none !important; }
        .nav-active { color: #2563eb !important; }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-900 pb-24">

    <div class="bg-blue-900 text-white overflow-hidden py-2 text-[10px] font-bold uppercase sticky top-0 z-[50]">
        <div class="whitespace-nowrap animate-marquee">
            ðŸš€ JOIN THE TOP EARNERS â€” LEVEL UP TO GOLD FOR 200% MORE REWARDS â€” WITHDRAWALS PROCESSED DAILY!
        </div>
    </div>

    <div id="auth-page" class="min-h-screen flex items-center justify-center p-6">
        <div class="w-full max-w-md bg-white rounded-3xl shadow-xl p-8">
            <h1 id="auth-title" class="text-3xl font-black text-blue-900 text-center mb-6">Digital Earn</h1>
            <div class="space-y-4">
                <input id="auth-email" type="email" placeholder="Email" class="w-full p-4 bg-slate-50 rounded-2xl outline-none">
                <input id="auth-pass" type="password" placeholder="Password" class="w-full p-4 bg-slate-50 rounded-2xl outline-none">
                <div id="register-extras" class="hidden-sec grid grid-cols-3 gap-2">
                    <div onclick="selectPlan(1)" id="p-1" class="border-2 border-blue-500 p-2 rounded-xl text-center text-[10px] font-bold">BASIC<br>700</div>
                    <div onclick="selectPlan(2)" id="p-2" class="border p-2 rounded-xl text-center text-[10px]">SILVER<br>1500</div>
                    <div onclick="selectPlan(3)" id="p-3" class="border p-2 rounded-xl text-center text-[10px]">GOLD<br>2500</div>
                </div>
                <button onclick="handleAuth()" id="auth-btn" class="w-full bg-blue-600 text-white font-bold py-4 rounded-2xl">Login</button>
            </div>
            <p class="text-center mt-6 text-xs text-slate-400">
                <button onclick="toggleAuthMode()" id="toggle-btn" class="text-blue-600 font-bold">Register Now</button>
            </p>
        </div>
    </div>

    <div id="home-sec" class="hidden-sec p-6 space-y-6">
        <div class="flex items-center justify-between bg-white p-4 rounded-2xl shadow-sm">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center text-blue-600 font-bold text-lg"><i class="fas fa-user"></i></div>
                <div>
                    <p id="top-email" class="text-xs font-bold text-slate-500 italic">User</p>
                    <span id="user-status" class="text-[9px] font-bold uppercase">Inactive</span>
                </div>
            </div>
            <button onclick="logout()"><i class="fas fa-power-off text-slate-300"></i></button>
        </div>

        <div class="bg-gradient-to-br from-blue-700 to-blue-900 p-8 rounded-[35px] text-white shadow-xl relative overflow-hidden">
            <p class="text-blue-200 text-[10px] uppercase font-bold">Available Balance</p>
            <h1 class="text-4xl font-black italic">Rs. <span id="user-balance">0.00</span></h1>
            <i class="fas fa-gem absolute -bottom-4 -right-4 text-8xl opacity-10"></i>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="bg-white p-4 rounded-2xl text-center border">
                <p class="text-[9px] text-slate-400 font-bold uppercase">Daily Limit</p>
                <p id="total-limit" class="text-xl font-bold">0</p>
            </div>
            <div class="bg-white p-4 rounded-2xl text-center border">
                <p class="text-[9px] text-slate-400 font-bold uppercase">Membership</p>
                <p id="plan-name" class="text-xl font-bold">BASIC</p>
            </div>
        </div>

        <div class="bg-white p-6 rounded-3xl border">
            <h3 class="font-bold mb-4 text-xs italic"><i class="fas fa-history text-blue-600 mr-2"></i>History</h3>
            <table class="w-full text-[10px]">
                <tbody id="history-list">
                    <tr><td colspan="3" class="py-4 text-center text-slate-300 italic">No transactions</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="task-sec" class="hidden-sec p-6">
        <h2 class="text-2xl font-black mb-6">Earn Center</h2>
        <div class="bg-white p-10 rounded-[40px] border-2 border-dashed border-blue-100 text-center space-y-6">
            <div class="w-24 h-24 bg-green-50 rounded-full flex items-center justify-center mx-auto text-green-600">
                <i class="fas fa-play text-4xl"></i>
            </div>
            <div>
                <p class="text-lg font-bold">Ready to Earn?</p>
                <p id="tasks-rem" class="text-sm text-slate-400">10 Tasks remaining today</p>
            </div>
            <button onclick="doTask()" class="w-full bg-blue-600 text-white font-bold py-5 rounded-3xl shadow-lg active:scale-95 transition-all">START TASK</button>
        </div>
    </div>

    <div id="profile-sec" class="hidden-sec p-6 space-y-6">
        <h2 class="text-2xl font-black">My Profile</h2>
        <div class="bg-white p-6 rounded-3xl space-y-4 shadow-sm">
            <div class="flex justify-between border-b pb-3 text-sm"><span>Email</span><span id="prof-email" class="font-bold text-blue-600"></span></div>
            <div class="flex justify-between border-b pb-3 text-sm"><span>Tier</span><span id="prof-plan" class="font-bold text-slate-700"></span></div>
            <div class="flex justify-between pb-1 text-sm"><span>Withdrawal Limit</span><span class="font-bold">Unlimited</span></div>
        </div>
        
        <div class="bg-blue-900 text-white p-6 rounded-3xl space-y-2">
            <h4 class="text-xs font-bold uppercase tracking-widest text-blue-300">Privacy Policy</h4>
            <p class="text-[10px] leading-relaxed opacity-80">
                Digital Earn protects your account using 256-bit encryption. We only store login credentials to maintain your balance and task history. Rewards are calculated based on verified ad views. By using this platform, you agree to our terms of service and daily task limits.
            </p>
        </div>
    </div>

    <nav id="bottom-nav" class="hidden-sec fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around py-4 shadow-2xl z-[5000]">
        <button onclick="showTab('home')" class="nav-btn text-slate-400 flex flex-col items-center gap-1" id="nav-home">
            <i class="fas fa-home text-lg"></i><span class="text-[10px] font-bold">Home</span>
        </button>
        <button onclick="showTab('task')" class="nav-btn text-slate-400 flex flex-col items-center gap-1" id="nav-task">
            <i class="fas fa-bolt text-lg"></i><span class="text-[10px] font-bold">Earn</span>
        </button>
        <button onclick="showTab('profile')" class="nav-btn text-slate-400 flex flex-col items-center gap-1" id="nav-profile">
            <i class="fas fa-user-circle text-lg"></i><span class="text-[10px] font-bold">Profile</span>
        </button>
    </nav>

    <a href="https://wa.me/923707340477" target="_blank" class="fixed bottom-24 right-6 bg-green-500 text-white w-14 h-14 rounded-full flex items-center justify-center shadow-2xl animate-bounce z-[4000]">
        <i class="fab fa-whatsapp text-3xl"></i>
    </a>

    <script>
        let user = JSON.parse(localStorage.getItem('user')) || null;
        let isLogin = true;
        let selLvl = 1;

        function toggleAuthMode() {
            isLogin = !isLogin;
            document.getElementById('auth-title').innerText = isLogin ? "Digital Earn" : "Register";
            document.getElementById('register-extras').classList.toggle('hidden-sec', isLogin);
            document.getElementById('toggle-btn').innerText = isLogin ? "Register Now" : "Login Now";
            document.getElementById('auth-btn').innerText = isLogin ? "Login" : "Register";
        }

        function selectPlan(l) {
            selLvl = l;
            document.querySelectorAll('#register-extras div').forEach(d => d.classList.remove('border-2', 'border-blue-500'));
            document.getElementById('p-'+l).classList.add('border-2', 'border-blue-500');
        }

        function showTab(tab) {
            ['home-sec', 'task-sec', 'profile-sec'].forEach(s => document.getElementById(s).classList.add('hidden-sec'));
            document.getElementById(tab + '-sec').classList.remove('hidden-sec');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('nav-active'));
            document.getElementById('nav-' + tab).classList.add('nav-active');
        }

        async function handleAuth() {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-pass').value;
            const btn = document.getElementById('auth-btn');
            btn.innerText = "Connecting...";
            try {
                const res = await fetch(isLogin ? '/api/login' : '/api/register', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ email, password, level: selLvl })
                });
                const data = await res.json();
                if(data.success) {
                    localStorage.setItem('user', JSON.stringify(data.user));
                    location.reload();
                } else { alert(data.error); btn.innerText = isLogin ? "Login" : "Register"; }
            } catch(e) { alert("Server Wake-up: Try in 1 minute"); btn.innerText = "Retry"; }
        }

        async function doTask() {
            if(!user.is_active) return alert("âŒ Account Inactive. Pay fee and contact WhatsApp.");
            const res = await fetch('/api/task', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ email: user.email })
            });
            const data = await res.json();
            if(data.success) { 
                alert("âœ… 10 PKR Earned!"); 
                const upd = await fetch('/api/login', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ email: user.email, password: user.password })
                });
                const d = await upd.json();
                localStorage.setItem('user', JSON.stringify(d.user));
                location.reload(); 
            } else alert(data.error);
        }

        function logout() { localStorage.clear(); location.reload(); }

        window.onload = () => {
            if(user) {
                document.getElementById('auth-page').classList.add('hidden-sec');
                document.getElementById('bottom-nav').classList.remove('hidden-sec');
                showTab('home');
                const plans = {1:"BASIC", 2:"SILVER", 3:"GOLD"};
                const lims = {1:10, 2:20, 3:30};
                document.getElementById('top-email').innerText = user.email;
                document.getElementById('prof-email').innerText = user.email;
                document.getElementById('user-balance').innerText = user.balance.toFixed(2);
                document.getElementById('plan-name').innerText = plans[user.level];
                document.getElementById('prof-plan').innerText = plans[user.level];
                document.getElementById('total-limit').innerText = lims[user.level];
                document.getElementById('tasks-rem').innerText = (lims[user.level] - (user.daily_count || 0)) + " Tasks remaining today";
                const st = document.getElementById('user-status');
                st.innerText = user.is_active ? "Verified" : "Unverified (Pay Fee)";
                st.className = user.is_active ? "text-[9px] font-bold text-green-500" : "text-[9px] font-bold text-red-500";
            }
        };
    </script>
</body>
</html>
