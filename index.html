<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Earn | Ultra Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background: #0f172a; color: #f8fafc; }
        .hidden-sec { display: none !important; }
        /* Glass Effect */
        .glass-card { 
            background: rgba(30, 41, 59, 0.7); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            border-radius: 24px;
        }
        .shiny-gold {
            background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
            box-shadow: 0 4px 15px rgba(217, 119, 6, 0.4);
        }
        .shiny-blue {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            box-shadow: 0 4px 15px rgba(29, 78, 216, 0.4);
        }
        #sidebar { transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); transform: translateX(-100%); }
        #sidebar.open { transform: translateX(0); }
        .progress-ring__circle { transition: 0.5s ease; transform: rotate(-90deg); transform-origin: 50% 50%; }
        /* Smooth Tab Transitions */
        .tab-content { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="font-sans overflow-hidden h-screen">

    <div id="sidebar" class="fixed inset-y-0 left-0 w-72 bg-slate-900/95 backdrop-blur-xl z-[6000] border-r border-white/10 flex flex-col">
        <div class="p-8 border-b border-white/5">
            <h2 class="text-2xl font-black italic tracking-tighter text-blue-400">DIGITAL EARN</h2>
            <p class="text-[10px] text-slate-500 uppercase tracking-widest font-bold">Secure Ecosystem</p>
        </div>
        <nav class="flex-1 overflow-y-auto p-4 space-y-2">
            <a onclick="navigate('home')" class="flex items-center gap-4 p-4 rounded-xl hover:bg-white/5 cursor-pointer transition-all"><i class="fas fa-home text-blue-400"></i> Home</a>
            <a onclick="navigate('profile')" class="flex items-center gap-4 p-4 rounded-xl hover:bg-white/5 cursor-pointer transition-all"><i class="fas fa-user-shield text-purple-400"></i> Profile</a>
            <a onclick="navigate('rewards')" class="flex items-center gap-4 p-4 rounded-xl hover:bg-white/5 cursor-pointer transition-all"><i class="fas fa-gem text-pink-400"></i> Rewards</a>
            <a onclick="navigate('income')" class="flex items-center gap-4 p-4 rounded-xl hover:bg-white/5 cursor-pointer transition-all"><i class="fas fa-chart-pie text-green-400"></i> Income</a>
            <a onclick="navigate('withdraw')" class="flex items-center gap-4 p-4 rounded-xl hover:bg-white/5 cursor-pointer transition-all"><i class="fas fa-wallet text-amber-400"></i> Withdraw</a>
            <a onclick="navigate('plans')" class="flex items-center gap-4 p-4 rounded-xl hover:bg-white/5 cursor-pointer transition-all"><i class="fas fa-crown text-yellow-400"></i> Plans</a>
            <a onclick="navigate('settings')" class="flex items-center gap-4 p-4 rounded-xl hover:bg-white/5 cursor-pointer transition-all"><i class="fas fa-cog text-slate-400"></i> Settings</a>
            <a onclick="openLogoutModal()" class="flex items-center gap-4 p-4 rounded-xl text-red-400 hover:bg-red-500/10 cursor-pointer mt-10"><i class="fas fa-power-off"></i> Logout</a>
        </nav>
    </div>

    <div id="auth-page" class="min-h-screen flex items-center justify-center p-6 bg-slate-950 absolute inset-0 z-[5000]">
        <div class="w-full max-w-md glass-card p-10">
            <div class="text-center mb-10">
                <div class="w-16 h-16 shiny-blue rounded-2xl flex items-center justify-center mx-auto mb-4 text-2xl"><i class="fas fa-shield-alt"></i></div>
                <h1 class="text-3xl font-black">Secure Login</h1>
                <p id="auth-sub" class="text-slate-500 text-sm">Enter credentials to proceed</p>
            </div>
            <div class="space-y-4">
                <input id="auth-email" type="email" placeholder="Email Address" class="w-full p-4 bg-slate-900 rounded-2xl border border-white/5 outline-none focus:border-blue-500">
                <input id="auth-pass" type="password" placeholder="Password" class="w-full p-4 bg-slate-900 rounded-2xl border border-white/5 outline-none focus:border-blue-500">
                
                <div id="register-extras" class="hidden-sec grid grid-cols-3 gap-2">
                    <div onclick="selectLvl(1)" id="p-1" class="border-2 border-blue-500 bg-blue-500/10 p-2 rounded-xl text-center cursor-pointer text-[10px] font-bold">BASIC<br>700</div>
                    <div onclick="selectLvl(2)" id="p-2" class="border border-white/10 p-2 rounded-xl text-center cursor-pointer text-[10px] font-bold">SILVER<br>1500</div>
                    <div onclick="selectLvl(3)" id="p-3" class="border border-white/10 p-2 rounded-xl text-center cursor-pointer text-[10px] font-bold">GOLD<br>2500</div>
                </div>

                <button onclick="handleAuth()" id="auth-btn" class="w-full shiny-blue text-white font-bold py-4 rounded-2xl active:scale-95 transition-all uppercase tracking-widest">Authorize</button>
            </div>
            <button onclick="toggleAuth()" class="w-full text-center mt-8 text-sm text-slate-500">Need account? <span class="text-blue-400 font-bold">Register</span></button>
        </div>
    </div>

    <div id="app-area" class="hidden-sec h-full flex flex-col">
        <header class="p-6 flex justify-between items-center z-10 sticky top-0 bg-slate-950/50 backdrop-blur-md">
            <button onclick="toggleSidebar()" class="w-10 h-10 glass-card flex items-center justify-center"><i class="fas fa-align-left text-blue-400"></i></button>
            <span id="page-title" class="font-black text-sm tracking-widest uppercase">Overview</span>
            <div class="w-10 h-10 shiny-blue rounded-full flex items-center justify-center text-xs"><i class="fas fa-user"></i></div>
        </header>

        <main class="flex-1 overflow-y-auto pb-32 p-6 space-y-6">

            <div id="tab-home" class="tab-content space-y-6">
                <div class="bg-gradient-to-tr from-blue-600 to-indigo-900 p-8 rounded-[40px] relative overflow-hidden shadow-2xl">
                    <p class="text-[10px] font-bold uppercase opacity-60 tracking-[4px]">Verified Balance</p>
                    <h1 class="text-4xl font-black mt-2">Rs. <span id="disp-balance">0.00</span></h1>
                    <div class="mt-8 flex gap-3">
                        <button onclick="navigate('withdraw')" class="px-6 py-2 bg-white/10 backdrop-blur rounded-full text-[10px] font-bold border border-white/10">Withdraw</button>
                        <button onclick="navigate('income')" class="px-6 py-2 bg-white/10 backdrop-blur rounded-full text-[10px] font-bold border border-white/10">History</button>
                    </div>
                    <i class="fas fa-fingerprint absolute -bottom-6 -right-6 text-9xl opacity-10"></i>
                </div>

                <div class="glass-card p-6 flex items-center justify-between">
                    <div class="relative w-20 h-20 flex items-center justify-center">
                        <svg class="w-20 h-20">
                            <circle class="text-white/5" stroke-width="6" stroke="currentColor" fill="transparent" r="35" cx="40" cy="40"/>
                            <circle id="progress-circle" class="text-blue-500 progress-ring__circle" stroke-width="6" stroke-dasharray="219.8" stroke-dashoffset="219.8" stroke-linecap="round" stroke="currentColor" fill="transparent" r="35" cx="40" cy="40"/>
                        </svg>
                        <span id="progress-text" class="absolute font-black text-xs">0%</span>
                    </div>
                    <div class="flex-1 ml-6">
                        <h4 class="font-bold text-sm">Work Progress</h4>
                        <p class="text-[10px] text-slate-500">Finish tasks to reach daily goal.</p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="glass-card p-5 text-center">
                        <i class="fas fa-users text-purple-400 mb-2"></i>
                        <p class="text-[9px] text-slate-500 font-bold uppercase">Referrals</p>
                        <p id="ref-count" class="font-black">0</p>
                    </div>
                    <div class="glass-card p-5 text-center">
                        <i class="fas fa-tasks text-green-400 mb-2"></i>
                        <p class="text-[9px] text-slate-500 font-bold uppercase">Done Today</p>
                        <p id="disp-tasks-done" class="font-black">0</p>
                    </div>
                </div>
            </div>

            <div id="tab-rewards" class="tab-content hidden-sec space-y-6">
                <div class="shiny-blue p-8 rounded-[40px] text-center">
                    <i class="fas fa-play-circle text-5xl mb-4"></i>
                    <h2 class="text-xl font-black">Ads Reward Center</h2>
                    <p class="text-xs opacity-70 mb-6">Earn up to 20 PKR per 30sec Ad</p>
                    <div class="bg-black/20 rounded-2xl p-4 mb-6">
                        <p id="task-rem-text" class="font-bold text-sm">10 Tasks Left</p>
                    </div>
                    <button onclick="doTask()" class="w-full bg-white text-blue-700 py-4 rounded-2xl font-black shadow-xl">Watch Now</button>
                </div>
                <div class="glass-card p-6">
                    <h4 class="font-bold text-sm mb-2 italic text-blue-400">Task Bonus Tip</h4>
                    <p class="text-[10px] text-slate-400">Upgrade to Gold plan to unlock 3x more rewards and instant processing.</p>
                </div>
            </div>

            <div id="tab-withdraw" class="tab-content hidden-sec space-y-6">
                <div class="glass-card p-8 border-amber-500/20">
                    <h2 class="text-xl font-black text-amber-500 mb-4">Request Fund</h2>
                    <div class="space-y-4">
                        <div class="bg-slate-900 rounded-2xl p-4 border border-white/5">
                            <label class="text-[9px] font-bold text-slate-500 uppercase">Amount</label>
                            <input id="w-amount" type="number" placeholder="Min 500" class="w-full bg-transparent outline-none font-bold">
                        </div>
                        <select id="w-method" class="w-full p-4 bg-slate-900 rounded-2xl border border-white/5 outline-none font-bold text-sm">
                            <option value="Easypaisa">Easypaisa</option>
                            <option value="JazzCash">JazzCash</option>
                        </select>
                        <input id="w-name" type="text" placeholder="Account Holder Name" class="w-full p-4 bg-slate-900 rounded-2xl border border-white/5 outline-none text-sm">
                        <input id="w-number" type="text" placeholder="Account Number" class="w-full p-4 bg-slate-900 rounded-2xl border border-white/5 outline-none text-sm">
                        <button onclick="requestWithdraw()" class="w-full shiny-gold text-white font-black py-4 rounded-2xl">Secure Withdrawal</button>
                    </div>
                </div>
                <div class="space-y-3" id="withdraw-history-list">
                    </div>
            </div>

            <div id="tab-settings" class="tab-content hidden-sec space-y-6">
                <h2 class="font-black text-xl px-2">Account Security</h2>
                <div class="glass-card p-6 space-y-5">
                    <div>
                        <label class="text-[10px] font-bold text-slate-500 uppercase">New Password</label>
                        <input id="set-pass" type="password" class="w-full p-4 bg-slate-900 rounded-2xl mt-1 outline-none border border-white/5">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-500 uppercase">Profile Lock</label>
                        <div class="flex justify-between items-center mt-2">
                            <p class="text-xs text-slate-400">Enable 2-Step Verification</p>
                            <div class="w-10 h-5 bg-blue-600 rounded-full"></div>
                        </div>
                    </div>
                    <button onclick="alert('Settings Updated!')" class="w-full bg-blue-600 py-4 rounded-2xl font-bold">Update Account</button>
                </div>
                <div class="glass-card p-6 bg-red-500/5 border-red-500/10">
                    <p class="text-red-400 text-xs font-bold"><i class="fas fa-exclamation-triangle mr-2"></i>Danger Zone</p>
                    <button class="text-[10px] text-slate-500 mt-2 underline">Permanently Delete Account</button>
                </div>
            </div>

        </main>

        <nav class="bg-slate-900/80 backdrop-blur-xl border-t border-white/5 p-4 flex justify-around fixed bottom-0 w-full z-50">
            <button onclick="navigate('home')" id="btn-home" class="flex flex-col items-center gap-1 text-blue-500">
                <i class="fas fa-home text-lg"></i><span class="text-[9px] font-bold">Home</span>
            </button>
            <button onclick="navigate('rewards')" id="btn-rewards" class="flex flex-col items-center gap-1 text-slate-500">
                <i class="fas fa-gem text-lg"></i><span class="text-[9px] font-bold">Rewards</span>
            </button>
            <button onclick="navigate('profile')" id="btn-profile" class="flex flex-col items-center gap-1 text-slate-500">
                <i class="fas fa-user-shield text-lg"></i><span class="text-[9px] font-bold">Profile</span>
            </button>
        </nav>
    </div>

    <div id="logout-modal" class="hidden-sec fixed inset-0 z-[7000] bg-black/90 flex items-center justify-center p-6 backdrop-blur-sm">
        <div class="glass-card p-10 w-full max-w-sm text-center">
            <h2 class="text-2xl font-black mb-4">Logout?</h2>
            <p class="text-slate-500 text-sm mb-8">Your secure session will be closed.</p>
            <div class="flex gap-4">
                <button onclick="closeLogoutModal()" class="flex-1 py-4 font-bold bg-slate-800 rounded-2xl">Cancel</button>
                <button onclick="logout()" class="flex-1 py-4 font-bold bg-red-600 rounded-2xl">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        let user = JSON.parse(localStorage.getItem('user')) || null;
        let isLogin = true;
        let selLvl = 1;

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
        function openLogoutModal() { document.getElementById('logout-modal').classList.remove('hidden-sec'); }
        function closeLogoutModal() { document.getElementById('logout-modal').classList.add('hidden-sec'); }
        function logout() { localStorage.clear(); location.reload(); }

        function navigate(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden-sec'));
            const target = 'tab-' + tab;
            if(document.getElementById(target)) document.getElementById(target).classList.remove('hidden-sec');
            
            document.getElementById('page-title').innerText = tab.toUpperCase();
            
            ['home', 'rewards', 'profile'].forEach(b => {
                const el = document.getElementById('btn-' + b);
                if(el) el.className = (b === tab) ? "flex flex-col items-center gap-1 text-blue-500" : "flex flex-col items-center gap-1 text-slate-500";
            });
            document.getElementById('sidebar').classList.remove('open');
        }

        function updateProgress(done, total) {
            const circle = document.getElementById('progress-circle');
            const percent = (done / total) * 100;
            const offset = 219.8 - (percent / 100 * 219.8);
            circle.style.strokeDashoffset = offset;
            document.getElementById('progress-text').innerText = Math.round(percent) + "%";
        }

        async function handleAuth() {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-pass').value;
            if(!email || !password) return alert("Required fields missing");
            const res = await fetch(isLogin ? '/api/login' : '/api/register', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ email, password, level: selLvl })
            });
            const data = await res.json();
            if(data.success) {
                localStorage.setItem('user', JSON.stringify(data.user));
                location.reload();
            } else alert(data.error);
        }

        function toggleAuth() {
            isLogin = !isLogin;
            document.getElementById('auth-btn').innerText = isLogin ? "Authorize" : "Create Account";
            document.getElementById('register-extras').classList.toggle('hidden-sec', isLogin);
        }

        async function doTask() {
            if(!user.is_active) return alert("Verification Required: Contact admin for account activation.");
            const res = await fetch('/api/task', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ email: user.email })
            });
            const data = await res.json();
            if(data.success) {
                localStorage.setItem('user', JSON.stringify({...user, balance: data.new_balance, history: data.history, daily_count: user.daily_count + 1}));
                location.reload();
            } else alert(data.error);
        }

        async function requestWithdraw() {
            const amount = document.getElementById('w-amount').value;
            const res = await fetch('/api/withdraw', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ email: user.email, amount, method: document.getElementById('w-method').value, accountTitle: document.getElementById('w-name').value, accountNumber: document.getElementById('w-number').value })
            });
            const data = await res.json();
            if(data.success) {
                alert("Withdrawal Locked & Submitted for processing.");
                localStorage.setItem('user', JSON.stringify(data.user));
                location.reload();
            } else alert(data.error);
        }

        window.onload = () => {
            if(user) {
                document.getElementById('auth-page').classList.add('hidden-sec');
                document.getElementById('app-area').classList.remove('hidden-sec');
                document.getElementById('disp-balance').innerText = user.balance.toFixed(2);
                document.getElementById('ref-count').innerText = user.referralCount || 0;
                
                const limits = {1:10, 2:20, 3:30};
                const max = limits[user.level || 1];
                document.getElementById('task-rem-text').innerText = (max - (user.daily_count || 0)) + " Tasks remaining";
                updateProgress(user.daily_count || 0, max);

                const wList = document.getElementById('withdraw-history-list');
                if(user.withdrawals) {
                    wList.innerHTML = user.withdrawals.map(w => `
                        <div class="glass-card p-4 flex justify-between">
                            <div><p class="font-bold text-xs">${w.method}</p><p class="text-[8px] text-slate-500">${w.date}</p></div>
                            <div class="text-right"><p class="font-black text-amber-500">Rs. ${w.amount}</p><p class="text-[8px] font-bold text-blue-400">${w.status}</p></div>
                        </div>
                    `).join('');
                }
            }
        };
    </script>
</body>
</html>
